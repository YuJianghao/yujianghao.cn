<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" href="/favicon.svg" type="image/svg+xml"><title>如何使用 JavaScript 获取 HTML 文本的显示范围</title><script type="module" crossorigin="" src="/assets/app.ddd9ab5e.js"></script><link rel="stylesheet" href="/assets/app.5c6d544e.css"><link rel="modulepreload" crossorigin="" href="/assets/how-to-get-text-rects-using-javascript.e5d9d1ed.js"><meta property="og:title" content="如何使用 JavaScript 获取 HTML 文本的显示范围"><meta name="head:count" content="1"></head><body class="font-sans text-gray-700 dark:text-gray-200"><div id="app" data-server-rendered="true"><div><div h-60px="" flex="" items-center="" px-4="" data-v-7b49c482=""><span op80="" data-v-7b49c482=""><img img-dark="" src="/assets/logo-white.e7f4b038.png" alt="logo" class="logo-img" data-v-7b49c482=""><img img-light="" src="/assets/logo-black.8e107588.png" alt="logo" class="logo-img" data-v-7b49c482=""></span><nav class="nav" flex="~ gap4" flex-1="" items-center="" op60="" cursor-pointer="" data-v-7b49c482=""><div flex-1="" data-v-7b49c482=""></div><a href="/posts" class="" title="Blog" data-v-7b49c482=""><span class="lt-md:hidden" data-v-7b49c482="">Blog</span><div i-ri-article-line="" md:hidden="" data-v-7b49c482=""></div></a><a href="https://github.com/YuJianghao" target="_blank" title="GitHub" data-v-7b49c482=""><div i-uil-github-alt="" data-v-7b49c482=""></div></a><a class="select-none" title="Toggle Color Scheme" data-v-7b49c482=""><i style="display:none" class="i-ri-moon-line"></i><i style="" class="i-ri-sun-line"></i></a></nav></div><main px7="" py10=""><div class="prose m-auto mb-8"><h1>如何使用 JavaScript 获取 HTML 文本的显示范围</h1><p mb-8="">Mar 26, 2022</p></div><article><!--[--><div class="prose m-auto"><p>先放答案。</p><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">getRects</span><span class="token punctuation">(</span><span class="token parameter">startDom<span class="token punctuation">,</span> startIndex<span class="token punctuation">,</span> endDom<span class="token punctuation">,</span> endIndex</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> range <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  range<span class="token punctuation">.</span><span class="token function">setStart</span><span class="token punctuation">(</span>startDom<span class="token punctuation">,</span> startIndex<span class="token punctuation">)</span>
  range<span class="token punctuation">.</span><span class="token function">setEnd</span><span class="token punctuation">(</span>endDom<span class="token punctuation">,</span> endIndex<span class="token punctuation">)</span>
  <span class="token keyword">return</span> range<span class="token punctuation">.</span><span class="token function">getClientRects</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><p>或者</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> context <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span><span class="token operator">!</span>
context<span class="token punctuation">.</span>font <span class="token operator">=</span> font
<span class="token keyword">const</span> metrics <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">measureText</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span>
<span class="token keyword">const</span> width <span class="token operator">=</span> metrics<span class="token punctuation">.</span>width
</code></pre><h2>原理</h2><p>使用<a href="https://developer.mozilla.org/en-US/docs/Web/API/Range" target="_blank" rel="noopener">Range</a>。Range 是一个 HTML 文档的片段，可以类比于 Photoshop 的选取。</p><ol><li>把需要测量的文本添加到选区中</li><li>使用<code class="">Range.getClientRects</code>获取选区的位置和大小信息</li><li>根据你应用中选区的排序情况，依次计算文本长度</li></ol><h2>注意事项</h2><p>需要注意选取的时候是选择了<code class="">Element Node</code>还是<code class="">Text Node</code>。例如需要选择 span 中文字的时候应该使用<code class="">Text Node</code></p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> rects <span class="token operator">=</span> <span class="token function">getRects</span><span class="token punctuation">(</span>span<span class="token punctuation">.</span>firstChild<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> span<span class="token punctuation">.</span>firstChild<span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span>
</code></pre><p>上述代码选择了 span 中的第三到第七（不含）个字符</p></div><!--]--></article><div class="prose m-auto mt-8 mb-8"><a href="/posts" class="font-mono no-underline opacity-50 hover:opacity-75">cd ..</a></div></main></div></div></body></html>